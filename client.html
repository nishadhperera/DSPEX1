<html>
    <head>
            <title> Calculator </title>

            <script type="text/javascript">
                var operators; // stores operators
                var operands;  // stores operands
                var result;
                var cachedResults = [];

                function toServer(n1, n2, op) {
                    var xmlhttp = new XMLHttpRequest();
                    xmlhttp.open("GET", "http://localhost:8081" + "?arg1=" + encodeURIComponent(n1) + "&arg2=" + encodeURIComponent(n2) + "&op=" + encodeURIComponent(op), false);
                    xmlhttp.send(null);
                    var fromServer =  xmlhttp.responseText;
                    return fromServer;
                }

                function arrangeData(){
                    result = 0;
                    operators = [];
                    operands = [];

                    /*while(operands.length > 0) {
                        operands.pop();
                        console.log("popped out");
                    }
                    while(operators.length > 0) {
                        operators.pop();
                        console.log("popped out");
                    }*/
                    var data = document.getElementById("num1").value;
                    var separators = [' ', '\\\+', '-', '\\\(', '\\\)', '\\*', '/', ':', '\\\?'];   // delimiters for parsing the input
                    operands = data.split(new RegExp(separators.join('|'), 'g'));     // get the operands into an array

                    var x = data.split("");
                    var index = 0;
                    for	(i = 0; i < x.length; i++) {
                        if (x[i] == "+") {
                            operators[index] = x[i];
                            index++;
                        } else if (x[i] == "-") {
                            operators[index] = x[i];
                            index++;
                        } else if (x[i] == "*") {
                            operators[index] = x[i];
                            index++;
                        } else if (x[i] == "/") {
                            operators[index] = x[i];
                            index++;
                        }
                    }
                    calculate();
                }
                function calculate(){
                    for	(i = 0; i < operands.length; i++){
                        var n1 = operands.shift();
                        var n2 = operands.shift();
                        var op = operators.shift();
                        console.log(i);
                        console.log(n1);
                        console.log(op);
                        console.log(n2);
                        console.log("----------------");
                        result = toServer(n1, n2, op);
                        cachedResults.push(n1 + op + n2 + "=" + result);
                        operands.unshift(result);
                    }
                    document.getElementById("result").value = result;

                    var node = document.createElement("P");
                    var textnode = document.createTextNode("Calculation steps :");
                    node.appendChild(textnode);
                    document.getElementById("history").appendChild(node);

                    for	(i = 0; i < cachedResults.length; i++){
                        var node = document.createElement("LI");
                        var textnode = document.createTextNode(""+cachedResults[i]);
                        node.appendChild(textnode);
                        document.getElementById("history").appendChild(node);
                    }
                }

                function cacheLimit(n){
                    cachedResults.length = n;
                }

            </script>

    </head>

    <body>
            <h1> Server based Calculator </h1>
            <form id="form1">
                <p> Input </p>
                <input type="text" id="num1">
                <select type="text" name="operation" id="operation">
                    <option val="+">+</option>
                    <option val="-">-</option>
                    <option val="*">*</option>
                    <option val="/">/</option>
                </select>
                <input type="text" id="num2">
                <input type="button" onClick="arrangeData()" id="submit" value="submit"><br>
                <p> Result </p>
                <input type="text" name="result" id="result" value=""><br><br><br>
                <p id="history" value="">  </p>
            </form>
    </body>

<html>